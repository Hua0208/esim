# 系統餘額加值工具

這個工具允許您以互動方式為系統餘額進行加值操作。

## 使用方法

### 方法一：使用 npm/yarn 腳本
```bash
# 使用 npm
npm run add-balance

# 使用 yarn
yarn add-balance
```

### 方法二：直接執行腳本
```bash
node add-balance.js
```

## 功能特點

✅ **餘額顯示** - 顯示當前系統餘額
✅ **交易記錄** - 顯示最近 5 筆交易記錄
✅ **互動式輸入** - 逐步引導您輸入加值金額和備註
✅ **金額驗證** - 驗證金額格式和範圍
✅ **精確計算** - 使用 Big.js 進行精確的金融計算
✅ **確認步驟** - 顯示加值前後餘額供確認
✅ **交易記錄** - 自動記錄所有加值操作

## 輸入要求

### 加值金額
- 格式：正數，最多 2 位小數
- 範圍：0.01 - 999,999.99
- 範例：100.50, 1000, 50.00

### 備註
- 可選欄位
- 如果不輸入，預設為「系統加值」
- 用於記錄加值原因或來源

## 範例執行

```
💰 系統餘額加值工具
==================

✅ 資料庫連接成功

💰 當前系統餘額: $1,250.75

📋 最近 5 筆交易記錄:
────────────────────────────────────────────────────────────────────────────────
日期時間              類型        金額            描述
────────────────────────────────────────────────────────────────────────────────
2024/12/17 14:30:25  儲值        $500.00        系統加值
2024/12/17 10:15:42  購買        $-25.50        購買 eSIM 卡
2024/12/16 16:20:18  儲值        $1,000.00      銀行轉帳
2024/12/16 09:45:33  購買        $-15.75        購買 eSIM 卡
2024/12/15 14:22:10  儲值        $250.00        現金加值
────────────────────────────────────────────────────────────────────────────────

請輸入加值金額: $1000

請輸入備註 (可選): 銀行轉帳

📋 請確認以下信息:
當前餘額: $1,250.75
加值金額: $1,000.00
加值後餘額: $2,250.75
備註: 銀行轉帳

是否確認執行加值? (y/N): y

🔄 正在執行加值...
✅ 系統加值成功!
📝 交易 ID: 15
💰 加值金額: $1,000.00
📅 交易時間: 2024/12/17 15:45:30
📝 備註: 銀行轉帳
💰 更新後餘額: $2,250.75
```

## 交易類型說明

- **儲值 (deposit)**: 系統加值操作，增加餘額
- **購買 (purchase)**: 購買 eSIM 卡，減少餘額
- **加值 (topup)**: 為現有 eSIM 加值，減少餘額

## 注意事項

⚠️ **安全提醒**
- 請妥善保管加值記錄
- 建議定期檢查餘額和交易記錄
- 不要在公共場所執行此工具

⚠️ **資料庫要求**
- 確保資料庫已正確配置
- 確保 Billing 表已創建
- 確保資料庫連接正常

⚠️ **金額限制**
- 單次加值金額不能超過 999,999.99
- 金額最多支援 2 位小數
- 系統使用 Big.js 確保計算精確性

## 錯誤處理

工具會處理以下常見錯誤：
- 資料庫連接失敗
- 金額格式錯誤
- 金額超出範圍
- 資料庫操作失敗

## 取消操作

在任何輸入步驟中，您可以：
- 按 `Ctrl+C` 強制退出
- 在確認步驟中輸入 `n` 或 `N` 取消加值

## 相關功能

- **查看餘額**: 工具會自動顯示當前餘額
- **交易記錄**: 顯示最近 5 筆交易記錄
- **餘額計算**: 自動計算加值後的餘額
- **記錄保存**: 所有加值操作都會保存到資料庫

## 技術細節

- 使用 `Big.js` 進行精確的金融計算
- 交易記錄類型為 `deposit`
- 自動設置交易狀態為「已完成」
- 記錄交易時間和備註資訊 