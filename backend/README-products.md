# 批量產品管理工具

這個工具允許您以多種方式批量添加或更新產品到系統中。

## 使用方法

### 方法一：使用 npm/yarn 腳本
```bash
# 使用 npm
npm run add-products

# 使用 yarn
yarn add-products
```

### 方法二：直接執行腳本
```bash
node add-products.js
```

## 功能特點

✅ **多種輸入方式** - 支援手動輸入、檔案讀取、批量輸入
✅ **自動獲取詳情** - 從 Mobimatter API 自動獲取產品詳細資訊
✅ **智能更新** - 自動檢測產品是否存在，選擇創建或更新
✅ **詳細顯示** - 顯示每個產品的完整資訊
✅ **錯誤處理** - 完善的錯誤處理和報告
✅ **進度追蹤** - 顯示處理進度和結果統計
✅ **Logo 下載** - 自動下載並保存供應商 Logo

## 輸入方式

### 1. 手動輸入模式
- 一個一個輸入 Product ID
- 輸入 "done" 完成輸入
- 輸入 "cancel" 取消操作
- 適合少量產品

### 2. 檔案讀取模式
- 從文字檔案讀取 Product ID 列表
- 每行一個 Product ID
- 支援註釋（以 # 開頭的行）
- 忽略空行
- 適合大量產品

### 3. 批量輸入模式
- 用逗號分隔多個 Product ID
- 一次性輸入所有產品
- 適合中等數量產品

## 檔案格式範例

### 產品 ID 檔案格式 (products-example.txt)
```
# 產品 ID 範例檔案
# 每行一個 Product ID
# 以 # 開頭的行會被忽略（註釋）
# 空行也會被忽略

# eSIM 即時產品
123456789
987654321
555666777

# eSIM 加值產品
111222333
444555666
777888999

# 其他產品
ABC123DEF
XYZ789GHI
```

## 範例執行

### 手動輸入模式
```
📦 批量產品管理工具
==================

✅ 資料庫連接成功

請選擇產品 ID 輸入方式:
1. 手動輸入（一個一個輸入）
2. 從檔案讀取（每行一個 product ID）
3. 批量輸入（用逗號分隔）

請選擇 (1-3): 1

📝 手動輸入模式
輸入 "done" 完成輸入，輸入 "cancel" 取消操作

請輸入 Product ID: 123456789
請輸入 Product ID: 987654321
請輸入 Product ID: done

產品狀態 (1=啟用, 2=停用): 1

📋 請確認以下信息:
產品數量: 2
產品狀態: 啟用
產品 ID 列表:
  1. 123456789
  2. 987654321

是否確認執行? (y/N): y

🚀 開始批量處理 2 個產品...

[1/2] 處理產品: 123456789
🔄 正在獲取產品 123456789 的詳細資訊...
➕ 創建新產品: 歐洲 10GB 30天 eSIM

📦 產品資訊:
   ID: 1
   Product ID: 123456789
   名稱: 歐洲 10GB 30天 eSIM
   類型: esim_realtime
   狀態: 啟用

💰 價格資訊:
   供應商: Airalo
   價格: 15.99 USD
   地區: Europe
   國家: France, Germany, Italy, Spain

📊 方案資訊:
   數據限制: 10 GB
   有效期: 30 天
   熱點: 支援
──────────────────────────────────

[2/2] 處理產品: 987654321
🔄 正在獲取產品 987654321 的詳細資訊...
📝 更新現有產品: 亞洲 5GB 7天 eSIM

📦 產品資訊:
   ID: 2
   Product ID: 987654321
   名稱: 亞洲 5GB 7天 eSIM
   類型: esim_realtime
   狀態: 啟用

💰 價格資訊:
   供應商: Holafly
   價格: 12.99 USD
   地區: Asia
   國家: Japan, South Korea, Taiwan

📊 方案資訊:
   數據限制: 5 GB
   有效期: 7 天
   熱點: 支援
──────────────────────────────────

📊 處理結果:
──────────────────────────────────
總數: 2
✅ 新增: 1
📝 更新: 1
❌ 失敗: 0

🎉 批量處理完成!
```

### 檔案讀取模式
```
請選擇產品 ID 輸入方式:
1. 手動輸入（一個一個輸入）
2. 從檔案讀取（每行一個 product ID）
3. 批量輸入（用逗號分隔）

請選擇 (1-3): 2

📁 檔案讀取模式
請輸入檔案路徑: products-example.txt

產品狀態 (1=啟用, 2=停用): 1

📋 請確認以下信息:
產品數量: 9
產品狀態: 啟用
產品 ID 列表:
  1. 123456789
  2. 987654321
  3. 555666777
  4. 111222333
  5. 444555666
  6. 777888999
  7. ABC123DEF
  8. XYZ789GHI

是否確認執行? (y/N): y
```

## 產品資訊顯示

工具會顯示每個產品的詳細資訊：

### 基本資訊
- **ID**: 資料庫中的產品 ID
- **Product ID**: Mobimatter 的產品 ID
- **名稱**: 產品名稱（從 API 獲取）
- **類型**: 產品類別（esim_realtime/esim_addon）
- **狀態**: 啟用/停用

### 價格資訊
- **供應商**: 產品供應商名稱
- **價格**: 零售價格和貨幣
- **地區**: 可用地區
- **國家**: 可用國家列表

### 方案資訊
- **數據限制**: 數據使用量限制
- **有效期**: 方案有效期（天）
- **熱點**: 是否支援熱點功能

## 注意事項

⚠️ **API 限制**
- 工具會在每個產品處理之間添加 1 秒延遲
- 避免對 Mobimatter API 造成過大負擔

⚠️ **網路連接**
- 需要穩定的網路連接來獲取產品詳情
- 如果 API 請求失敗，該產品會被標記為失敗

⚠️ **檔案格式**
- 檔案必須是 UTF-8 編碼
- 每行一個 Product ID
- 支援註釋和空行

⚠️ **資料庫要求**
- 確保資料庫已正確配置
- 確保 Product 和 ProductDetail 表已創建
- 確保資料庫連接正常

## 錯誤處理

工具會處理以下常見錯誤：
- 資料庫連接失敗
- API 請求失敗
- 產品 ID 格式錯誤
- 檔案讀取錯誤
- 圖片下載失敗

## 取消操作

在任何輸入步驟中，您可以：
- 按 `Ctrl+C` 強制退出
- 在確認步驟中輸入 `n` 或 `N` 取消操作
- 在手動輸入模式中輸入 "cancel"

## 技術細節

- 使用 Mobimatter API 獲取產品詳情
- 自動下載並保存供應商 Logo
- 智能檢測產品是否存在
- 使用 Sequelize ORM 進行資料庫操作
- 完整的錯誤處理和日誌記錄 